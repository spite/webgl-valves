<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>webgl valves</title>	
	<style>
	*{margin:0;padding:0;box-model:border-box;}
	</style>
</head>

<script>

( function() {

	function log() {
		console.log.apply( console, arguments );
	}

	var instrumented = [];
	var parameters = {};

	for( var j in WebGLRenderingContext.prototype ) {
		try {
			if( typeof WebGLRenderingContext.prototype[ j ] === 'number' ){
				parameters[ j ] = WebGLRenderingContext.prototype[ j ];
			}
		} catch( e ) {
			//console.log( j );
		}
	}

	function _h ( f, pre, post ) {
		instrumented.push( f.name );
		return function () {
			var args = pre.apply( this, arguments ) || arguments;
			var res = f.apply( this, args );
			var r;
			return post ? ( r = post( res, args ), r ? r : res ) : res;
		};
	}

	WebGLRenderingContext.prototype._guidBufferCount = 0;
	WebGLRenderingContext.prototype._guidProgramCount = 0;
	WebGLRenderingContext.prototype._guidTextureCount = 0;

	WebGLRenderingContext.prototype.clear = _h( 
		WebGLRenderingContext.prototype.clear, 
		function () {
			log( 'clear', arguments[ 0 ] && this.DEPTH_BUFFER_BIT, arguments[ 0 ] && this.STENCIL_BUFFER_BIT, arguments[ 0 ] && this.COLOR_BUFFER_BIT )
		}
	);

	WebGLRenderingContext.prototype.getExtension = _h( 
		WebGLRenderingContext.prototype.getExtension, 
		function() {},
		function( res, arguments ) {
			log( 'getExtension', arguments[ 0 ], '->', res )
		}
	);

	function getParameter( num ) {
		for( var j in parameters ) { 
			if( parameters[ j ] === num ) {
				return j;
			}
		}
		throw new Error()
	}

	WebGLRenderingContext.prototype.getParameter = _h( 
		WebGLRenderingContext.prototype.getParameter, 
		function() {},
		function ( res, arguments ) {
			log( 'getParameter', getParameter( arguments[ 0 ] ), '->', res );
		}
	);

	WebGLRenderingContext.prototype.enable = _h( 
		WebGLRenderingContext.prototype.enable, 
		function () {
			log( 'enable', getParameter( arguments[ 0 ] ) );
		}
	);

	WebGLRenderingContext.prototype.disable = _h( 
		WebGLRenderingContext.prototype.disable, 
		function () {
			log( 'disable', getParameter( arguments[ 0 ] ) );
		}
	);

	WebGLRenderingContext.prototype.frontFace = _h( 
		WebGLRenderingContext.prototype.frontFace, 
		function () {
			log( 'frontFace', getParameter( arguments[ 0 ] ) );
		}
	);

	WebGLRenderingContext.prototype.cullFace = _h( 
		WebGLRenderingContext.prototype.cullFace, 
		function () {
			log( 'cullFace', getParameter( arguments[ 0 ] ) );
		}
	);

	WebGLRenderingContext.prototype.clearColor = _h( 
		WebGLRenderingContext.prototype.clearColor, 
		function () {
			log( 'clearColor', arguments[ 0 ], arguments[ 1 ], arguments[ 2 ], arguments[ 3 ] );
		}
	);

	WebGLRenderingContext.prototype.clearDepth = _h( 
		WebGLRenderingContext.prototype.clearDepth, 
		function () {
			log( 'clearDepth', arguments[ 0] );
		}
	);

	WebGLRenderingContext.prototype.clearStencil = _h( 
		WebGLRenderingContext.prototype.clearStencil, 
		function () {
			log( 'clearStencil', arguments[ 0] );
		}
	);

	WebGLRenderingContext.prototype.depthFunc = _h( 
		WebGLRenderingContext.prototype.depthFunc, 
		function () {
			log( 'depthFunc', getParameter( arguments[ 0 ] ) );
		}
	);

	WebGLRenderingContext.prototype.blendEquation = _h( 
		WebGLRenderingContext.prototype.blendEquation, 
		function () {
			log( 'blendEquation', getParameter( arguments[ 0 ] ) );
		}
	);

	WebGLRenderingContext.prototype.blendFunc = _h( 
		WebGLRenderingContext.prototype.blendFunc, 
		function () {
			log( 'blendFunc', getParameter( arguments[ 0 ] ), getParameter( arguments[ 1 ] ) );
		}
	);

	WebGLRenderingContext.prototype.blendEquationSeparate = _h( 
		WebGLRenderingContext.prototype.blendEquationSeparate, 
		function () {
			log( 'blendEquationSeparate', getParameter( arguments[ 0 ] ), getParameter( arguments[ 1 ] ) );
		}
	);

	WebGLRenderingContext.prototype.blendFuncSeparate = _h( 
		WebGLRenderingContext.prototype.blendFuncSeparate, 
		function () {
			log( 'blendFuncSeparate', getParameter( arguments[ 0 ] ), getParameter( arguments[ 1 ] ), getParameter( arguments[ 2 ] ), getParameter( arguments[ 3 ] ) );
		}
	);

	WebGLRenderingContext.prototype.scissor = _h( 
		WebGLRenderingContext.prototype.scissor, 
		function () {
			log( 'scissor', arguments[ 0 ], arguments[ 1 ], arguments[ 2 ], arguments[ 3 ] );
		}
	);

	WebGLRenderingContext.prototype.viewport = _h( 
		WebGLRenderingContext.prototype.viewport, 
		function () {
			log( 'viewport', arguments[ 0 ], arguments[ 1 ], arguments[ 2 ], arguments[ 3 ] );
		}
	);

	WebGLRenderingContext.prototype.depthMask = _h( 
		WebGLRenderingContext.prototype.depthMask, 
		function () {
			log( 'depthMask', arguments[ 0 ] );
		}
	);

	WebGLRenderingContext.prototype.colorMask = _h( 
		WebGLRenderingContext.prototype.colorMask, 
		function () {
			log( 'colorMask', arguments[ 0 ], arguments[ 1 ], arguments[ 2 ], arguments[ 3 ] );
		}
	);

	WebGLRenderingContext.prototype.getShaderPrecisionFormat = _h( 
		WebGLRenderingContext.prototype.getShaderPrecisionFormat, 
		function(){},
		function( res, arguments ) {
			log( 'getShaderPrecisionFormat', getParameter( arguments[ 0 ] ), getParameter( arguments[ 1 ] ), '->', res );
		}
	);

	WebGLRenderingContext.prototype.createBuffer = _h( 
		WebGLRenderingContext.prototype.createBuffer, 
		function () {
			//log( 'createBuffer', arguments )
		},
		function( buffer ) {
			buffer._guid = ++WebGLRenderingContext.prototype._guidBufferCount
			log( 'createBuffer', buffer._guid )
			return buffer;
		}
	);

	WebGLRenderingContext.prototype.bindBuffer = _h( WebGLRenderingContext.prototype.bindBuffer, function () {
		log( 'bindBuffer', getParameter( arguments[ 0 ] ), arguments[ 1 ]._guid )
	} );

	WebGLRenderingContext.prototype.bufferData = _h( WebGLRenderingContext.prototype.bufferData, function () {
		log( 'bufferData', getParameter( arguments[ 0 ] ), '[data]', getParameter( arguments[ 2 ] ) )
	} );

	WebGLRenderingContext.prototype.createTexture = _h( 
		WebGLRenderingContext.prototype.createTexture, 
		function () {
			//log( 'createTexture', arguments )
		},
		function( res, arguments ) {
			res._guid = ++WebGLRenderingContext.prototype._guidTextureCount
			log( 'createTexture', '->', res._guid )
			return res;
		}
	);

	WebGLRenderingContext.prototype.bindTexture = _h( 
		WebGLRenderingContext.prototype.bindTexture, 
		function () {
			log( 'bindTexture', getParameter( arguments[ 0 ] ), arguments[ 1 ]._guid )
		} 
	);

	WebGLRenderingContext.prototype.texParameteri = _h( WebGLRenderingContext.prototype.texParameteri, function () {
		log( 'texParameteri', getParameter( arguments[ 0 ] ), getParameter( arguments[ 1 ] ), getParameter( arguments[ 2 ] ) )
	} );

	WebGLRenderingContext.prototype.texImage2D = _h( WebGLRenderingContext.prototype.texImage2D, function () {
		log( 'texImage2D', getParameter( arguments[ 0 ] ), arguments[ 1 ], getParameter( arguments[ 2 ] ), arguments[ 3 ] + 'x' + arguments[ 4 ], arguments[ 5 ], getParameter( arguments[ 6 ] ), getParameter( arguments[ 7 ]) )
	} );

	WebGLRenderingContext.prototype.createProgram = _h( 
		WebGLRenderingContext.prototype.createProgram, 
		function () {
			//log( 'createProgram', arguments )
		},
		function( program ) {
			program._guid = ++WebGLRenderingContext.prototype._guidProgramCount
			log( 'createProgram', program._guid )
			return program;
		}
	);

	WebGLRenderingContext.prototype.createShader = _h( WebGLRenderingContext.prototype.createShader, function () {
		log( 'createShader', getParameter( arguments[ 0 ] ) )
	} );

	WebGLRenderingContext.prototype.useProgram = _h( WebGLRenderingContext.prototype.useProgram, function () {
		log( 'useProgram', arguments[ 0 ]._guid )
	} );

	WebGLRenderingContext.prototype.getAttribLocation = _h( 
		WebGLRenderingContext.prototype.getAttribLocation, 
		function () {
			log( 'getAttribLocation', arguments )
		}
	);

	WebGLRenderingContext.prototype.vertexAttribPointer = _h( WebGLRenderingContext.prototype.vertexAttribPointer, function () {
		log( 'vertexAttribPointer', arguments )
	} );

	WebGLRenderingContext.prototype.enableVertexAttribArray = _h( WebGLRenderingContext.prototype.enableVertexAttribArray, function () {
		log( 'enableVertexAttribArray', arguments )
	} );

	WebGLRenderingContext.prototype.drawArrays = _h( WebGLRenderingContext.prototype.drawArrays, function () {
		arguments[ 2 ] = Math.min( arguments[ 2 ], window.max );
		log( 'drawArrays', arguments )
		return arguments;
	} );

	WebGLRenderingContext.prototype.drawElements = _h( WebGLRenderingContext.prototype.drawElements, function () {
		arguments[ 1 ] = Math.min( arguments[ 1 ], window.max );
		log( 'drawElements', arguments );
		return arguments;
	} );

	// enableVertexAttribArray/vertexAttribPointer
	// useProgram
	// createBuffer/bindBuffer/bufferData

	window.max = 100000000;

	for( var j in WebGLRenderingContext.prototype ) {
		if( instrumented.indexOf( j ) === -1 ) {
			try {
				if( typeof WebGLRenderingContext.prototype[ j ] === 'function' ){

					( function( id ) { 
					WebGLRenderingContext.prototype[ j ] = _h( 
						WebGLRenderingContext.prototype[ j ], 
						function() {
							log( id, arguments );
						}
					);
					})( j );

				}
			} catch( e ) {
				//console.log( j );
			}
		}
	}

})();

</script>

<script src="three.js" ></script>

<body>
</body>

<script>

var scene = new THREE.Scene();
var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
camera.position.z = 15;

var renderer = new THREE.WebGLRenderer( { antialias: true } );
renderer.setPixelRatio( window.devicePixelRatio )
document.body.appendChild( renderer.domElement );

var geometries = [];
geometries.push( new THREE.IcosahedronGeometry( 1, 3 ) );
geometries.push( new THREE.BoxGeometry( 1, 1, 1, 10, 10, 10 ) );
geometries.push( new THREE.TorusKnotGeometry( 1, .3, 100, 16 ) );

var materials = [];
materials.push( new THREE.MeshNormalMaterial( { wireframe: false } ) );
materials.push( new THREE.MeshBasicMaterial( { color: 0xb70000, wireframe: false } ) );
materials.push( new THREE.MeshBasicMaterial( { color: 0x0000b7, wireframe: false } ) );

var meshes = [];
var r = 10
for( var j =0 ; j< 10; j++ ) {
	var mesh = new THREE.Mesh( geometries[ ~~ ( Math.random() * geometries.length ) ], materials[ ~~ ( Math.random() * materials.length ) ] );
	mesh.position.set( ( .5 - Math.random() ) * r, ( .5 - Math.random() ) * r, ( .5 - Math.random() ) * r )
	meshes.push( mesh );
	scene.add( mesh );
}

function onWindowResize() {
	renderer.setSize( window.innerWidth, window.innerHeight );
	camera.aspect = window.innerWidth / window.innerHeight;
	camera.updateProjectionMatrix();
}

window.addEventListener( 'resize', onWindowResize );
onWindowResize();

function render() {
	requestAnimationFrame( render );
	meshes.forEach( function ( mesh ) {
		mesh.rotation.x += 0.01;
		mesh.rotation.y += 0.01;
	})
	console.log( '---- START RENDER ---- ' )
	renderer.render( scene, camera );
	console.log( '---- FINISH RENDER ---- ' )
	debugger
}
render();

</script>

</html>